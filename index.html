<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>سلطة الأعماق</title>

<style>
body {
  background:black;
  color:#ff4444;
  font-family:Courier New, monospace;
  text-align:center;
  overflow:hidden;
  direction: rtl;
}

#room {
  position:relative;
  width:100vw;
  height:80vh;
}

.escapeBtn {
  position:absolute;
  padding:10px 18px;
  background:#111;
  border:2px solid #ff4444;
  color:#ff4444;
  cursor:pointer;
}

#flash {
  position:fixed;
  inset:0;
  background:white;
  opacity:0;
  pointer-events:none;
}

#overlay {
  position:fixed;
  inset:0;
  background:black;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}

#diver {
  position:fixed;
  inset:0;
  margin:auto;
  max-width:60%;
  opacity:0;
  pointer-events:none;
  transition: opacity 0.2s;
}

.shake {
  animation: shake .15s infinite;
}

@keyframes shake {
  0%{transform:translate(0)}
  25%{transform:translate(4px)}
  50%{transform:translate(-4px)}
  75%{transform:translate(4px)}
  100%{transform:translate(0)}
}
</style>
</head>

<body>

<h1>⚠ سلطة الأعماق</h1>
<p>ابحث عن زر الهروب.</p>

<div id="room"></div>
<div id="flash"></div>

<img id="diver" src="DIVER.png">

<div id="overlay">
  <h2 id="panicText">تنظيف النظام جارٍ</h2>
  <p>S̷̤̦͕͊̂̂͛Q̷̼̞̺̣̐̀W̵̨͉̣͙̒I̷̳͔̗͐͂͜G̶͈̥̫̈̍͝Ḷ̷̝̮͒̈̄̀È̶͓͂̑</p>
</div>

<audio id="guiltAudio" src="guilt.mp3"></audio>

<script>
const room = document.getElementById("room");
const flash = document.getElementById("flash");
const overlay = document.getElementById("overlay");
const panicText = document.getElementById("panicText");
const guiltAudio = document.getElementById("guiltAudio");
const diver = document.getElementById("diver");

const ctx = new (window.AudioContext||window.webkitAudioContext)();
let purge = false;
let berserk = false;
let clicks = 0;

// ---------- NOISE ----------
function jumpscareSound(freq){
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = "sawtooth";
  o.frequency.value = freq;
  g.gain.value = 0.35;
  o.connect(g).connect(ctx.destination);
  o.start();
  setTimeout(()=>o.stop(),180);
}

// ---------- BUTTONS ----------
const total = 5;
const trapIndex = Math.floor(Math.random()*total);

for(let i=0;i<total;i++){
  const b = document.createElement("button");
  b.textContent = "هروب";
  b.className = "escapeBtn";
  b.style.left = Math.random()*85 + "%";
  b.style.top = Math.random()*80 + "%";

  b.onclick = () => {
    ctx.resume();
    if(i === trapIndex){
      startGuilt();
    } else {
      scare(i);
    }
  };

  room.appendChild(b);
}

function scare(i){
  flash.style.opacity = 1;
  document.body.classList.add("shake");
  jumpscareSound(200+i*60);

  setTimeout(()=>{
    flash.style.opacity = 0;
    document.body.classList.remove("shake");
    randomize();
  },120);
}

function randomize(){
  document.querySelectorAll(".escapeBtn").forEach(b=>{
    b.style.left = Math.random()*85 + "%";
    b.style.top = Math.random()*80 + "%";
  });
}

// ---------- GUILT ----------
function startGuilt(){
  purge = true;
  overlay.style.display = "flex";
  guiltAudio.play();

  // fade diver while voice plays
  const fade = setInterval(()=>{
    if(diver.style.opacity < 1){
      diver.style.opacity = parseFloat(diver.style.opacity) + 0.002;
    }
  }, 20);

  guiltAudio.onended = () => {
    clearInterval(fade);
    diver.style.opacity = 1;
    goBerserk();
  };
}

function goBerserk(){
  berserk = true;
  document.body.classList.add("shake");

  setInterval(()=>{
    panicText.textContent = "الواقع غير مستقر " + Math.floor(Math.random()*9999);
  },80);
}

// ---------- CLICK TRAP ----------
document.body.onclick = ()=>{
  if(!purge) return;

  // clicking while voice plays = trap
  if(purge && !berserk){
    jumpscareSound(120);
    diver.style.opacity = Math.max(0, diver.style.opacity - 0.05);
    return;
  }

  if(!berserk) return;

  clicks++;
  flash.style.opacity = .6;
  jumpscareSound(300+clicks*3);

  setTimeout(()=>flash.style.opacity=0,60);

  if(clicks > 40){
    overlay.innerHTML = "<h2>تم استعادة الاستقرار</h2><p>العودة إلى الغواصة…</p>";
    setTimeout(()=>{
      location.href = "https://noodliegames.github.io/DEEP-SEEK/";
    },1500);
  }
};

// ---------- FLICKER ----------
setInterval(()=>{
  document.body.style.background = Math.random()>.5?"black":"#120000";
},150);
</script>

</body>
</html>


