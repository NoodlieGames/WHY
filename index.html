<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>سلطة الأعماق</title>

<style>
body {
  background:black;
  color:#ff4444;
  font-family:Courier New, monospace;
  text-align:center;
  overflow:hidden;
  direction: rtl;
}

#room {
  position:relative;
  width:100vw;
  height:80vh;
}

.escapeBtn {
  position:absolute;
  padding:10px 18px;
  background:#111;
  border:2px solid #ff4444;
  color:#ff4444;
  cursor:pointer;
}

#flash {
  position:fixed;
  inset:0;
  background:white;
  opacity:0;
  pointer-events:none;
}

#overlay {
  position:fixed;
  inset:0;
  background:black;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}

.shake {
  animation: shake .2s;
}

@keyframes shake {
  0%{transform:translate(0)}
  25%{transform:translate(6px)}
  50%{transform:translate(-6px)}
  75%{transform:translate(6px)}
  100%{transform:translate(0)}
}
</style>
</head>

<body>

<h1>⚠ سلطة الأعماق</h1>
<p>ابحث عن زر الهروب.</p>

<div id="room"></div>
<div id="flash"></div>

<div id="overlay">
  <h2 id="panicText">تنظيف النظام جارٍ</h2>
  <p>اضغط لتثبيت الواقع</p>
</div>

<!-- ملف الصوت المحلي الخاص بك -->
<audio id="guiltAudio" src="guilt.mp3"></audio>

<script>
const room = document.getElementById("room");
const flash = document.getElementById("flash");
const overlay = document.getElementById("overlay");
const panicText = document.getElementById("panicText");
const guiltAudio = document.getElementById("guiltAudio");

const ctx = new (window.AudioContext||window.webkitAudioContext)();
let purge = false;
let clicks = 0;

function jumpscareSound(freq){
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = "sawtooth";
  o.frequency.value = freq;
  g.gain.value = 0.35;
  o.connect(g).connect(ctx.destination);
  o.start();
  setTimeout(()=>o.stop(),180);
}

const total = 11;
const trapIndex = Math.floor(Math.random()*total);

for(let i=0;i<total;i++){
  const b = document.createElement("button");
  b.textContent = "هروب";
  b.className = "escapeBtn";
  b.style.left = Math.random()*85 + "%";
  b.style.top = Math.random()*80 + "%";

  b.onclick = () => {
    ctx.resume();
    if(i === trapIndex){
      startGuilt();
    } else {
      scare(i);
    }
  };

  room.appendChild(b);
}

function scare(i){
  flash.style.opacity = 1;
  document.body.classList.add("shake");
  jumpscareSound(200+i*60);

  setTimeout(()=>{
    flash.style.opacity = 0;
    document.body.classList.remove("shake");
    randomize();
  },120);
}

function randomize(){
  document.querySelectorAll(".escapeBtn").forEach(b=>{
    b.style.left = Math.random()*85 + "%";
    b.style.top = Math.random()*80 + "%";
  });
}

function startGuilt(){
  purge = true;
  overlay.style.display = "flex";
  guiltAudio.play();
  setInterval(()=>{
    panicText.textContent = "الواقع غير مستقر " + Math.floor(Math.random()*999);
  },120);
}

document.body.onclick = ()=>{
  if(!purge) return;

  clicks++;
  flash.style.opacity = .6;
  jumpscareSound(300+clicks*3);

  setTimeout(()=>flash.style.opacity=0,60);

  if(clicks > 35){
    overlay.innerHTML = "<h2>تم استعادة الاستقرار</h2><p>العودة إلى الغواصة…</p>";
    setTimeout(()=>{
      location.href = "yourgame.html"; // عدل الرابط إلى لعبتك
    },1500);
  }
};

setInterval(()=>{
  document.body.style.background = Math.random()>.5?"black":"#120000";
},180);
</script>

</body>
</html>
